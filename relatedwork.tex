\chapter{Theoretical background}
\label{chap:background}

This chapter introduces the mathematical concepts and tools needed for
topological analysis of decision boundaries. We begin with \emph{persistent homology},
a fundamental tool for measuring topological features at different scales. We
then present several types of simplicial complexes that can be used to capture
the topology of decision boundaries, discussing their properties and
relationships to each other. The ultimate goal is to compute persistent homology
of decision boundaries using these complexes.

\section{Persistent homology}

\begin{figure}
    \centering
    \begin{tikzpicture}
        % Axes
        \draw[->] (0,0) -- (6,0) node[right] {Birth};
        \draw[->] (0,0) -- (0,6) node[above] {Death};
        
        % Grid
        \draw[gray!30] (0,0) grid (6,6);
        
        % Diagonal
        \draw[dashed] (0,0) -- (6,6);
        
        % Point coords
        \coordinate (p1) at (1,3);
        \coordinate (p2) at (2,4);
        \coordinate (p3) at (3,5);
        \coordinate (p4) at (1.5,2);
        
        % Lines to axes
        \draw[dashed,gray] (p1) -- (1,0) node[below,black] {$b_1$};
        \draw[dashed,gray] (p1) -- (0,3) node[left,black] {$d_1$};
        \draw[dashed,gray] (p2) -- (2,0) node[below,black] {$b_2$};
        \draw[dashed,gray] (p2) -- (0,4) node[left,black] {$d_2$};
        \draw[dashed,gray] (p3) -- (3,0) node[below,black] {$b_3$};
        \draw[dashed,gray] (p3) -- (0,5) node[left,black] {$d_3$};
        \draw[dashed,gray] (p4) -- (1.5,0) node[below,black] {$b_4$};
        \draw[dashed,gray] (p4) -- (0,2) node[left,black] {$d_4$};

        % Points
        \fill (p1) circle (2pt) node[above right] {$p_1$};
        \fill (p2) circle (2pt) node[above right] {$p_2$};
        \fill (p3) circle (2pt) node[above right] {$p_3$};
        \fill (p4) circle (2pt) node[above right] {$p_4$};
    \end{tikzpicture}
    \caption{An example of a persistent diagram. A point $p_i$ is born at $b_i$ and dies at $d_i$.}
    \label{fig:pd}
\end{figure}

Persistent homology serves as a fundamental tool in TDA that tracks how
topological features (connected components, holes) appear and disappear as a
parameter is varied~\cite{edelsbrunner2010computational}.  Given a filtered
simplicial complex $(K_\epsilon)_{\epsilon \geq 0}$, persistent homology
computes pairs $(b_i, d_j)$ where a feature appears at
$\epsilon = b_i$ (birth) and disappears at $\epsilon = d_i$ (death).

These birth--death pairs can be visualized in a \emph{persistence diagram}, where each pair
is shown as a point in the Euclidean plane. The distance of a point from the diagonal
indicates the feature's persistence, which is often interpreted as a measure of
its significance. Figure~\ref{fig:pd} shows an example of a persistence diagram.

\section{Simplicial complexes}

To study the topology of decision boundaries, we need constructions that can
capture their structure using only finite samples from the input space. Several
types of simplicial complexes have been developed for this purpose, each with
its own advantages and trade-offs.

One such complex is the \emph{Dowker complex}, which has been used to study
tumor microenvironments~\cite{stolz2023relationalpersistenthomologymultispecies}.

\begin{definition}
    Let \(X, Y\) be sets. The \emph{Dowker complex} \(\mathcal{D}_{X, Y}^\varepsilon\)
    at parameter value \(\varepsilon\) is a simplicial complex
    with \(X\) as its vertex set, including the \(n\)-simplex
    \((x_0, \dots, x_n)\) if and only if there exists \(y \in Y\)
    such that \(\norm{x_i - y} \leq \varepsilon\) for all \(i\).
\end{definition}
A \emph{Dowker filtration} can be obtained by varying \(\varepsilon\).

Although the roles of $X$ and $Y$ may appear arbitrary, the following theorem shows
that they can be interchanged without changing the homology groups, up to isomorphism:
\begin{theorem}[Dowker, \cite{dowker1952homology}]
    For any Dowker complex constructed from two sets $X$ and $Y$,
    interchanging the roles of $X$ and $Y$ and keeping the same value of $\varepsilon$
    results in homology groups that isomorphic to the original ones:
    \begin{equation}
        H_k(\mathcal{D}_{X, Y}^\varepsilon) \cong H_k(\mathcal{D}_{Y, X}^\varepsilon).
    \end{equation}
\end{theorem}

The labeled \v{C}ech complex has been introduced as a theoretical tool to study
decision boundaries of neural networks, offering probabilistic guarantees that
it correctly captures the topology of these
boundaries~\cite{ramamurthy2018topologicaldataanalysisdecision}.

\begin{definition}
    Given a set of points \(X\), a reference set \(Y\), and parameters \(\varepsilon\) and \(\gamma\),
    the \emph{labeled \v{C}ech complex} $L\check{C}_{X, Y}^{\varepsilon, \gamma}$ contains
    an \(n\)-simplex formed by points \(x_0, \dots, x_n \in X\) if and only if:
    \begin{enumerate}
        \item \(\bigcap_{i = 0}^n B_\varepsilon(x_i) \neq \emptyset\)
        \item For each \(i \in (0, \dots, n)\), there exists \(y \in Y\) such that
        \(\norm{x_i - y} \leq \gamma\).
    \end{enumerate}
\end{definition}
The \emph{labeled \v{C}ech filtration} is obtained by varying \(\varepsilon\),
while keeping \(\gamma\) fixed. Figure~\ref{fig:lc} shows an example of a labeled
\v{C}ech complex constructed on points from two different classes.

The parameter $\varepsilon$ encodes a distance threshold within $X$,
similarly to the \v{C}ech complex, while the parameter $\gamma$ encodes a distance threshold
from points in $X$ to $Y$, similarly to the Dowker complex. More concretely,
\begin{equation}
    L\check{C}_{X, Y}^{\varepsilon, \gamma} = \check{C}_X^\varepsilon \cap D_{X, Y}^\gamma,
\end{equation}
where $\check{C}_X^\varepsilon$ is the \emph{\v{C}ech complex}.

Both the labeled \v{C}ech complex and the Dowker complex only capture simplices
with vertices in $X$, i.e.\ on one side of the decision boundary. This makes them
not directly applicable to the multiclass setting, as they would only capture simplices
on the boundary of one class, ignoring the decision boundary between the other classes.
Moreover, both of these complexes are computationally expensive. An alternative
approach is to use the \emph{labeled Vietoris-Rips (LVR)
complex}~\cite{ramamurthy2018topologicaldataanalysisdecision},
which can be applied to multiple classes and is more tractable at the cost of
not having known recovery guarantees.

\begin{figure}
    \centering
    \resizebox{0.8\textwidth}{!}{\input{plots/lc.pgf}}
    \caption{An example of the labeled \v{C}ech complex. Only 0- and 1-simplices are shown for clarity.}
    \label{fig:lc}
\end{figure}

\begin{definition}
    Given a set of points \(X\) with associated labels \(c: X \to \{1,\ldots,k\}\) and 
    a parameter \(\varepsilon > 0\), the \emph{labeled Vietoris-Rips complex} is constructed 
    in three steps:
    \begin{enumerate}
        \item Create a graph \(G_\varepsilon\) with vertex set \(X\) by adding an edge 
        between points \(x_i, x_j \in X\) if and only if:
        \begin{itemize}
            \item \(\norm{x_i - x_j} \leq \varepsilon\) (points are close enough), and
            \item \(c(x_i) \neq c(x_j)\) (points belong to different classes)
        \end{itemize}
        
        \item Add edges between all 2-hop neighbors in \(G_\varepsilon\), i.e.\ add an 
        edge between \(x_i\) and \(x_k\) if there exists \(x_j\) such that both 
        \((x_i, x_j)\) and \((x_j, x_k)\) are edges in \(G_\varepsilon\).
        
        \item Build higher-dimensional simplices by adding an \(n\)-simplex whenever all 
        of its \((n-1)\)-dimensional faces are present in the complex, similarly to the 
        standard Vietoris-Rips complex.
    \end{enumerate}
\end{definition}

\begin{figure}
    \centering
    \resizebox{0.8\textwidth}{!}{\input{plots/lvr.pgf}}
    \caption{An example of the labeled Vietoris-Rips complex. Only 0- and 1-simplices are shown for clarity.}
    \label{fig:lvr}
\end{figure}

The \emph{labeled Vietoris-Rips filtration} can be obtained by varying \(\varepsilon\).
An example of the LVR complex constructed on the same point set is shown in
Figure~\ref{fig:lvr}. Comparing it to Figure~\ref{fig:lc}, we can see that
the LVR complex captures simplices that cross the boundary between the two classes,
while the labeled \v{C}ech complex only captures simplices on one side of the boundary.

While it is known that the VR and \v{C}ech complexes are log-interleaved through inclusions~\cite{edelsbrunner2010computational}:
\begin{equation}
    \check{C}_X^\varepsilon \subseteq VR_X^\varepsilon \subseteq \check{C}_X^{2\varepsilon},
    \label{eq:interleave}
\end{equation}
it is not clear how the labeled versions compare.

The \emph{locally scaled labeled Vietoris-Rips complex (LS-LVR complex)} aims to
recover homology groups of datasets with non-uniform density more accuractely
compared to the LVR complex.

\begin{definition}
    The \emph{LS-LVR complex} is constructed similarly to the LVR complex,
    but with the distance constraint for an edge \((x_i, x_j)\) being given
    by \(\norm{x_i - x_j} \leq \varepsilon \sqrt{\rho_i, \rho_j}\),
    where \(\rho_i\) is the distance from \(x_i\) to its \(k\)-th closest neighbor,
    with \(k\) being a fixed parameter.
\end{definition}